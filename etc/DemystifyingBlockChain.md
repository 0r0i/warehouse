# 가볍게 읽어 보는 블록체인 이야기

2017년도 벌써 3/4가 지나갔다. 올 한해를 정리해보기엔 좀 이른 시간이지만, 그래도 이 시점에서 중간 점검 차 한 번 짚어보자. 소프트웨어 업계에서 올해 1~9월 사이에 일어났던 많은 일 들 가운데 가장 큰 이슈로 무엇을 꼽을 수 있을까?

여러 이슈가 있겠지만, 필자의 짧은 생각으로는 비트코인에 대한 관심의 폭증과 그에 따른 암호화 화폐 시장의 급등락과 ICO(Initial Coin Offering)를 꼽고 싶다.

-- 비트코인 가격 차트 --
-- 이더리움 가격 차트 --
-- 주요 ICO 모금액 표 --

주변에서 몇 억을 벌었다는 이야기도 심심치 않게 들을 수 있고, 그에 못지 않게 많은 돈을 잃었다는 이야기도 들을 수 있다. 길게 볼 것 없이 올해 초 대비만 하더라도 변동성이 크긴 했지만 비트코인과 기타 암호화 화폐의 가격이 급등한 것은 사실이다. 그래서 거품이다, 17세기 유럽의 튤립 광풍과 다를게 없다 등의 이야기도 많이 들을 수 있다. 분명 가격으로만 보면 틀린 말이 아닐 수도 있다. 게다가 개발자가 아닌 일반인의 관점에서 보면 아무래도 기술적인 내용은 이해하기 어렵고, 가격에 급등락에 의한 여러 에피소드는 이해하기 쉬울 테니, 가격에 대한 면이 부각되는 것은 어쩔 수 없는 일이기는 하다.

하지만 마이크로소프트웨어라는 이 잡지를 보고 있는 우리는 소프트웨어를 다루는 개발자들이다. 그리고 비트코인도 당연하지만 소프트웨어다. 그럼에도 불구하고, 우리나라에서는 개발자들마저 비트코인을 바라보는 관점이 일반인의 관점과 크게 다르지 않은 것 같다. 그래서 이번 기회에 개발자답게, 일반인들보다 조금 더 깊게 탐험해 보고, 어떤 의미를 가지고 있는지 알아보자.

## 비트코인과 블록체인

제목은 블록체인 이야기라고 써놓고, 서두에서는 비트코인 얘기만 했다. 비트코인과 블록체인이 무엇인지 구별하는 것이 좋겠다는 의도에서 일부러 그렇게 기술했다.

>블록체인은 비트코인의 바탕이 되는 '체계'이며,
>
>비트코인은 블록체인을 '화폐'에 응용한 결과물이다.

블록체인이 바탕이고, 비트코인은 블록체인 바탕위에서 구현된 하나의 서비스 또는 상품이라고 할 수 있다. 그래서 블록체인은 비트코인 뿐아니라 다른 코인의 바탕이 될 수도 있고 실제로도 그렇다. 또한 블록체인은 코인 뿐아니라 다른 서비스나 상품의 바탕이 될 수도 있다.

재미있는 것은 블록체인이 비트코인의 바탕이 되는 체계이지만, 블록체인이 만들어지고 비트코인이 만들어진 것이 아니라 비트코인을 만들기 위해 고민하던 중에 블록체인이라는 기술이 탄생했다는 점이다.(위키 등 참고해서 해쉬코인 등 역사얘기를 쓸까말까..)

이제부터 블록체인이 어떻게 비트코인이라는 화폐의 바탕이 되는 체계가 될 수 있는지 알아보자. 그 전에, 먼저 화폐가 무엇인지 짧게 되새겨 보자.

## 화폐는 믿음이다

현대 사회에서 화폐란 무엇일까? 너무 모호한 것 같으니 질문을 바꿔보자. 현대 사회에서 화폐의 '실체'란 무엇일까? 과거에는 금이나 은 등 실제 실물이 화폐의 역할을 담당했지만, 점차 그 실물에 대한 교환 증서가 화폐의 역할을 담당하게 되었고, 1971년의 브레턴 우즈 체제에서는 사실 상 그 실물(금)에 대한 교환도 보장해 주지 않는 불태환 화폐가 되었고, 2008년 금융 위기 이후에는 양적 완화라는 미명 하에 막대한 양의 화폐를 찍어내기도 했다.그럼에도 불구하고 여전히 우리는 그 화폐를 가지고 큰 문제 없이 살아가고 있다. 어째서 이런 일이 가능할까?

>화폐는 '믿음'이다.

그렇다. 사실 우리는 화폐를 믿고 있다. 화폐의 실체는 바로 믿음이다. 금으로 교환해준다는 보장은 사라졌지만, 화폐로 여전히 치킨을 먹고 맥주를 마실 수 있다고 모두가 믿고 있다. 화폐는 모두의 '신뢰'를 받고 있는 것이다. 비트코인이 가상화폐, 디지털 화폐 또는 암호화 화폐처럼 화폐라는 용어를 달고 있는 이유도 '신뢰'할 만한 대상이 될 수 있기 때문이다. 그 신뢰의 원천이 바로 블록체인이다.

그럼 블록체인이 어떻게 신뢰의 원천이 될 수 있는지 차례차례 알아보자.

## 분산 공개 장부

A가 B에게 만원을 보내는 상황을 생각해보자. A가 은행 사이트에 접속해서 로그인하고, 잔액을 확인하고, B의 계좌 정보를 입력한 후에, 공인인증서나 OTP 등의 비밀번호를 입력하고 확인 버튼을 누르면, A의 잔액에서 만원이 차감되고, B의 잔액에 만원이 더해진다. 개인의 재산이 오가는 이 송금 과정은 매우 중요하다. 그래서 송금 거래에 필요한 모든 확인 과정은 은행에서 수행되며, 그 기록도 은행에 저장되고 외부로는 공개되지 않는다. 그래서 송금에 대해 우리가 믿는 곳은 은행 하나다. 송금 과정에 있어서의 모든 것이 은행 하나에 집중되어 있다. 이는 바꿔 말하면 은행이 바로 단일 실패 지점(Single Point of Failure)이라는 말이다. 즉, 거래 은행의 서버가 정상적으로 동작하지 않거나, 은행의 기록이 사라지게 되면 우리는 재산을 잃게 된다.

소프트웨어 시스템 분야에서 이런 단일 실패 지점 문제를 해결하는 보편적인 방법은 고가용성 처리, 쉽게 말해 다중화다. 2중, 3중으로 복제나 분산처리를 해서 단일 실패 지점을 없애는 전략을 취한다. 은행 시스템도 이런 다중화 처리가 되어 있으므로 앞에서 말한 어처구니 없는 불상사는 쉽게 일어나지 않는다. 소프트웨어 뿐 아니라 보안 담당 직원 배치, 보안 담당 장비 도입 등으로 더 한층 위험을 낮춘다. 하지만 이런 조치를 위해서는 많은 비용이 필요하다. 

블록체인은 이 문제를 완전히 다른 각도에서 바라본다(각주: 설명의 단순화를 위해 이후로 퍼블릭 블록체인만을 대상으로 한다). 즉, 거래 정보를 감추지 않고 모두에게 공개하고, 누구나 거래 정보를 생성할 수 있으며, 거래 정보를 모두에게 복사해서 사본을 저장하고 그 사본끼리 동기화시킨다. 쉽게 말해 2중화, 3중화 정도가 아니라 수천중화, 수만중화 처리를 해서 기록이 사라지는 일을 원천적으로 막아버린다. 그래서 블록체인을 거대한 분산 공개 장부라고 부르기도 한다.

>블록체인은 거대한 분산 공개 장부다.

이렇게 수천 수만의 분산 처리를 통해 기록의 멸실은 막을 수 있지만, 이것만으로는 멸실만큼이나 위험한 기록의 위/변조까지 막을 수는 없다. 블록체인은 이 문제를 암호학의 도움을 받아서 해결한다.

## 디지털 서명

개발자라면 디지털 서명에 대해 희미하게라도 알고 있겠지만, 블록체인을 얘기할 때 빼놓을 수 없는 중요한 부분이므로 다시 한 번 짚고 넘어가자.

디지털 서명은 비대칭키와 해쉬 함수를 이용해서 다음과 같은 방식으로 데이터의 진위 여부를 확인할 수 있게 해준다.

** 디지털 서명 그림 **

블록체인에 담겨 있는 모든 거래 정보에는 이렇게 디지털 서명이 포함되어 있어서 거래 정보가 진본임을 신뢰할 수 있다.

## 블록이란?

자 이제부터 진짜 블록체인의 내부로 들어가볼 차례다. 블록체인이라는 체인을 이루는 원소인 블록은 무엇일까?

>블록은 유효한 거래 정보의 묶음이다.

하나의 블록에는 약 $$$개의 거래 정보가 포함될 수 있으며, 블록의 물리적인 크기는 대략 $$$이다. 블록은 블록 헤더와 거래 정보, 기타 정보로 구성된다.

- 블록 헤더는 version, previousblockhash, merklehash, time, bits, nonce 이렇게 6개의 정보로 구성된다.
- 거래 정보는 입출금과 관련한 여러가지 정보를 가지고 있다.
- 기타 정보는 블록 내에 있는 정보 중에서 블록 헤더와 거래 정보에 해당하지 않는 정보를 말하며, 블록 해쉬 계산에 사용되지 않는다.

이 중에서 블록체인의 메커니즘을 이해하는 데 중요한 열쇠가 되는 정보는 블록 헤더다.

### 블록 헤더

블록 헤더는 다음의 6가지 정보로 구성된다.

1. version : 소프트웨어/프로토콜 버전
2. previousblockhash : 블록 체인에서 바로 앞에 위치하는 블록의 블록 해쉬
3. merklehash : 개별 거래 정보의 거래 해쉬를 2진 트리 형태로 구성할 때, 트리 루트에 위치하는 해쉬값
4. time : 블록이 생성된 시간
5. bits : 난이도 조절용 수치
6. nonce : 최초 0에서 시작하여 조건을 만족하는 해쉬값을 찾아낼때까지의 1씩 증가하는 계산 회수

블록 헤더가 중요한 이유는 블록의 식별자 역할을 하는 블록 해쉬가 이 블록 헤더의 6가지 정보를 입력값으로 해서 구해지기 때문이다.

### 블록 해쉬

블록의 식별자 역할을 하는 블록 해쉬는 6가지의 블록 헤더 정보를 입력값으로 하고, 여기에 SHA256 해쉬 함수를 2회 적용해서 계산되는 값으로, 32바이트의 숫자값이다. 이름은 블록 해쉬이지만 그 값은 블록 전체를 해쉬한 값이 아니라, 블록 헤더를 해쉬한 값이다.

지금까지의 내용을 바탕으로 블록 해쉬를 구하는 과정을 그림으로 나타내면 다음과 같다.

![Imgur](http://i.imgur.com/KFtqafZ.png)

개별 거래 정보는 결국 머클 트리의 해쉬값인 `merklehash` 값으로 집약된다. 블록 헤더의 6가지 정보 중에서 `version`, `previousblockhash`, `merklehash`, `time`, `bits` 이렇게 5가지는 블록 해쉬를 만드는 시점에서 이미 확정되어 변하지 않는 값이다. 하지만 마지막 `nonce`는 확정되어 있지 않고 새로 구해야 하는 값이다. 이 `nonce` 값을 구해서 최종적으로 블록 해쉬 값을 구하고, 이 블록 해쉬값을 식별자로 가지는 유효한 블록을 만들어내는 것이 바로 흔히 말하는 채굴이다.

채굴에 대해 알아보기 전에, 이제 블록이 무엇인지 알게 되었으니 블록이 이어져서 만들어지는 블록체인에 대해 알아보자.

## 블록체인이란?

블록체인은 앞에서는 거대한 분산 공개 장부라고 했는데, 그것은 개념적인 정의이고, 기술적으로는 블록이 이어져서 만들어진 블록의 집합체라고 말할 수 있다.

>블록체인은 블록이 이어져서 만들어진 블록의 집합체다.

블록들은 어떻게 이어져 있는걸까? 앞에서 살펴본 블록 헤더의 6가지 정보 중의 하나인 `previousblockhash` 값은 현재 생성하고 있는 블록 바로 이전에 만들어진 블록의 블록 해쉬값이다. 블록은 바로 앞의 블록 해쉬 값을 포함하는 방식으로 앞의 블록과 이어지게 된다. 

$$$ 블록 체인 그림 - previousHash값

어디서 많이 본 구조 아닌가? 그렇다. 블록체인은 사실 링크드리스트다. 그림으로 보면 다음과 같다.


## 블록체인의 핵심 - 작업 증명

## 블록

## 블록 체인

## 이중 지불 문제

비트코인은 컴퓨터로 만들어낸 디지털 화폐다. 디지털이라는 것에 항상 뒤따라 다니는 문제 중의 하나는 불법 복제다. 비트코인도 그렇지 않을까? 과정이야 어찌됐든 일단 디지털 만원을 만들어냈다면 백 번 복사하면 백만원이 되고, 만 번 복사하면 1억원이 될 수 있다. 

구체적으로 사례를 들어보면, 디지털 만원을 한 개 만들어서 마트에 가서 그 만원을 지불하고 수박 한 통을 사고, 그 디지털 만원을 복사해서 다른 서점에 가서 지불하고 책을 한 권 살 수 있다면 그 디지털 만원이 사람들의 신뢰를 얻을 수 있을까? 수박 장사도 그 디지털 만원을 복사할 수 있고, 서점 주인도 그 디지털 만원을 복사할 수 있다. 그렇게 복사한 디지털 만원이 실제 만원의 가치를 계속 가진다면, 수박 장사는 앞으로 수박을 팔 필요 없이 그저 디지털 만원을 복사해서 여러 곳에 지불하고 필요한 물건을 사면서 살면 된다. 그렇게 쉽게 만들어 낼 수 있는 돈은 아무도 믿지 않는다. 결국 디지털 화폐가 신뢰를 받을 수 있느냐 없느냐는 바로 이 이중 지불을 어떻게 방지하느냐에 달려 있다.

블록체인은 아주 기발한 방법으로 이 이중 지불 문제를 해결했다.



## 비트코인을 넘어서
