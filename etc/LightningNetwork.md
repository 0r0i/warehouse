# Lightning Network

https://medium.com/@melik_87377/lightning-network-enables-unicast-transactions-in-bitcoin-lightning-is-bitcoins-tcp-ip-stack-8ec1d42c14f5

- tx를 네트워크 내 모든 노드로 전파하는 비트코인은 브로드캐스팅과 유사
- 이더넷 허브가 데이터를 처리하는 것과 유사

- 이더넷 허브도 확장성 부족
- 누군가에게 1M 파일을 하나 보내려면 네트워크 내 있는 다른 99개 노드에도 보내짐
- 비트코인 같은 글로벌 결제 네트워크가 브로드캐스팅으로 운영된다는 것은 있을 수 없는 일

- 이더넷 허브의 확장성 한계를 돌파하게 해준 것이 IP 계층을 통한 유니 캐스트
- 실제 현재 컴퓨터 세상의 통신은 주로 유니캐스트로 동작
- 라이트닝 네트워크는 유니캐스트를 가능하게 해주는 IP 계층과 유사

- 전통적인 네트워크에서는 데이터 패킷을 일대일로 주고 받지만, 라이트닝 네트워크에서는 비트코인을 일대일로 주고 받는다.
- 원시적인 네트워크가 글로벌 인터넷이 된 것은 IP 덕분
- 라이트닝 네트워크도 원시적이고 확장성이 떨어지는 비트코인 네트워크를 글로벌 네트워크로 만들어줄 것이다.

- 라이트닝 노드가 IP 호스트라면 라이트닝 채널은 TCP 연결에 해당

- 라이트팅은 비트코인의 TCP/IP 스택에 해당

- 브로드캐스팅 기반의 온체인으로는 탈중앙화를 유지하면서 확장 실제 불가
- 탈중앙화를 유지하면서 확장하려면 오프체인이어야 한다.

https://medium.com/@x0100/lightning-network-45b4b2119d97

- OP_CheckMultiSig: 멀티 시그 확인
- OP_CheckSequenceVerify: 몇 블록 후에만 지불 가능한 옵션

1. 앨리스와 밥이 멀티시그 지갑에 각각 X, Y 비트코인을 보내는 tx를 생성한다.
2. 하지만 둘 모두 해당 tx에 사인을 하지도 않고, tx를 비트코인 네트워크로 보내는 데도 사인하지 않는다.
    - 메인 체인에 기록되면 둘 중 하나가 사인하지 않으면 먼저 돈을 넣은 쪽은 회수 불가능하므로
3. 대신에 앨리스와 밥은 멀티시그 지갑에서 각자 X, Y의 비트코인을 원래의 지갑으로 보내는 A1, B1라는 tx 생성
4. 밥은 A1에 서명하고 앨리스에게 A1 전송, 앨리스는 B1에 서명하고 밥에게 B1 전송
    - 상대방이 상대방의 돈을 원래대로 가져가는 것에 동의
    - 상대방의 동의는 이미 얻은 상태므로 나중에 나만 동의하면 원래대로 가져올 수 있음
    - 세그윗 이전에는 Transaction Malleability 때문에 이 부분이 쉽지 않았으나, 세그윗 이후에는 이 부분이 쉬움
5. 안전하게 돌려받을 수 있는 장치가 마련되었으므로 멀티시그 지갑에 돈을 넣는 최초의 tx에 각자 서명하고 비트코인 네트워크에 전송

![https://medium.com/@x0100/lightning-network-45b4b2119d97](https://i.imgur.com/llWzNsY.png)


여기서부터는 유추한 내 생각

- 즉 일반 노드로만 이루어진 메인 네트워크는 브로드캐스트로 동작하지만 라이트닝 노드는 일대일 통신 가능
- 일대일이면 굳이 합의가 필요 없음

## 질문

- 일대일 연결 경로가 어떻게 찾아지나
    - 일반 네트워크에서는 DNS와 라우터가 이 일을 담당한다. 비트코인에서는?
- 
